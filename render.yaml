services:
  - type: web
    name: kitchenette
    env: python
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn kitchenette.wsgi:application"
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: kitchenette.settings
    migrationsCommand: |
      python manage.py migrate
      python manage.py loaddata menu_data.json
      echo "
from django.contrib.auth import get_user_model
User = get_user_model()
if not User.objects.filter(username='admin').exists():
    User.objects.create_superuser('admin', 'admin@example.com', 'adminpass')
" | python manage.py shell
